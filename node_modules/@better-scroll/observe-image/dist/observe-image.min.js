!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).ObserveImage=t()}(this,function(){"use strict";var r="undefined"!=typeof window,n=r&&navigator.userAgent.toLowerCase(),o=(n&&/wechatdevtools/.test(n),n&&n.indexOf("android"),function(){if("string"!=typeof n)return;var e=/os (\d\d?_\d(_\d)?)/.exec(n);if(!e)return;var t=e[1].split("_").map(function(e){return parseInt(e,10)});13===t[0]&&t[1]}(),!1);if(r){try{var e={};Object.defineProperty(e,"passive",{get:function(){o=!0}}),window.addEventListener("test-passive",function(){},e)}catch(e){}}var i=r&&document.createElement("div").style,t=function(){if(!r)return!1;for(var e=0,t=[{key:"standard",value:"transform"},{key:"webkit",value:"webkitTransform"},{key:"Moz",value:"MozTransform"},{key:"O",value:"OTransform"},{key:"ms",value:"msTransform"}];e<t.length;e++){var n=t[e];if(void 0!==i[n.value])return n.key}return!1}();function s(e){return!1===t?e:"standard"===t?"transitionEnd"===e?"transitionend":e:t+e.charAt(0).toUpperCase()+e.substr(1)}function a(e,t,n,r){var i=o?{passive:!1,capture:!!r}:!!r;e.addEventListener(t,n,i)}function d(e,t,n,r){e.removeEventListener(t,n,{capture:!!r})}t&&"standard"!==t&&t.toLowerCase();var u=s("transform"),f=s("transition"),p=(r&&s("perspective")in i,s("transitionTimingFunction"),s("transitionDuration"),s("transitionDelay"),s("transformOrigin"),s("transitionEnd"),s("transitionProperty"),c.prototype.destroy=function(){this.removeDOMEvents(),this.events=[]},c.prototype.addDOMEvents=function(){this.handleDOMEvents(a)},c.prototype.removeDOMEvents=function(){this.handleDOMEvents(d)},c.prototype.handleDOMEvents=function(t){var n=this,r=this.wrapper;this.events.forEach(function(e){t(r,e.name,n,!!e.capture)})},c.prototype.handleEvent=function(t){var n=t.type;this.events.some(function(e){return e.name===n&&(e.handler(t),!0)})},c);function c(e,t){this.wrapper=e,this.events=t,this.addDOMEvents()}function v(e){this.scroll=e,this.refreshTimer=0,this.init()}return v.prototype.init=function(){this.handleOptions(this.scroll.options.observeImage),this.bindEventsToWrapper()},v.prototype.handleOptions=function(e){void 0===e&&(e={}),e=!0===e?{}:e;this.options=function(e,t){for(var n in t)e[n]=t[n];return e}({debounceTime:100},e)},v.prototype.bindEventsToWrapper=function(){var e=this.scroll.scroller.wrapper;this.imageLoadEventRegister=new p(e,[{name:"load",handler:this.load.bind(this),capture:!0}]),this.imageErrorEventRegister=new p(e,[{name:"error",handler:this.load.bind(this),capture:!0}])},v.prototype.load=function(e){var t=this,n=e.target,r=this.options.debounceTime;n&&"img"===n.tagName.toLowerCase()&&(0===r?this.scroll.refresh():(clearTimeout(this.refreshTimer),this.refreshTimer=window.setTimeout(function(){t.scroll.refresh()},this.options.debounceTime)))},v.pluginName="observeImage",v});
