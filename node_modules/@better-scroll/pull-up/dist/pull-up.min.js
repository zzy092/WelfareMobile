!function(t,o){"object"==typeof exports&&"undefined"!=typeof module?module.exports=o():"function"==typeof define&&define.amd?define(o):(t="undefined"!=typeof globalThis?globalThis:t||self).PullUp=o()}(this,function(){"use strict";var n="undefined"!=typeof window,i=n&&navigator.userAgent.toLowerCase();i&&/wechatdevtools/.test(i),i&&i.indexOf("android"),function(){if("string"!=typeof i)return;var t=/os (\d\d?_\d(_\d)?)/.exec(i);if(!t)return;var o=t[1].split("_").map(function(t){return parseInt(t,10)});13===o[0]&&o[1]}();if(n){try{var t={};Object.defineProperty(t,"passive",{get:function(){}}),window.addEventListener("test-passive",function(){},t)}catch(t){}}var s=n&&document.createElement("div").style,o=function(){if(!n)return!1;for(var t=0,o=[{key:"standard",value:"transform"},{key:"webkit",value:"webkitTransform"},{key:"Moz",value:"MozTransform"},{key:"O",value:"OTransform"},{key:"ms",value:"msTransform"}];t<o.length;t++){var i=o[t];if(void 0!==s[i.value])return i.key}return!1}();function e(t){return!1===o?t:"standard"===o?"transitionEnd"===t?"transitionend":t:o+t.charAt(0).toUpperCase()+t.substr(1)}o&&"standard"!==o&&o.toLowerCase();var l=e("transform"),r=e("transition"),c=(n&&e("perspective")in s,e("transitionTimingFunction"),e("transitionDuration"),e("transitionDelay"),e("transformOrigin"),e("transitionEnd"),e("transitionProperty"),[{key:"finishPullUp",name:"finishPullUp"},{key:"openPullUp",name:"openPullUp"},{key:"closePullUp",name:"closePullUp"},{key:"autoPullUpLoad",name:"autoPullUpLoad"}].map(function(t){return{key:t.key,sourceKey:"plugins.pullUpLoad."+t.name}})),h="pullingUp";function a(t){this.scroll=t,this.pulling=!1,this.watching=!1,this.init()}return a.prototype.init=function(){this.handleBScroll(),this.handleOptions(this.scroll.options.pullUpLoad),this.handleHooks(),this.watch()},a.prototype.handleBScroll=function(){this.scroll.registerType([h]),this.scroll.proxy(c)},a.prototype.handleOptions=function(t){void 0===t&&(t={}),t=!0===t?{}:t;this.options=function(t,o){for(var i in o)t[i]=o[i];return t}({threshold:0},t),this.scroll.options.probeType=3},a.prototype.handleHooks=function(){var t=this;this.hooksFn=[];var o=this.scroll.scroller.scrollBehaviorY;this.registerHooks(this.scroll.hooks,this.scroll.hooks.eventTypes.contentChanged,function(){t.finishPullUp()}),this.registerHooks(o.hooks,o.hooks.eventTypes.computeBoundary,function(t){0<t.maxScrollPos&&(t.maxScrollPos=-1)})},a.prototype.registerHooks=function(t,o,i){t.on(o,i,this),this.hooksFn.push([t,o,i])},a.prototype.watch=function(){this.watching||(this.watching=!0,this.registerHooks(this.scroll,this.scroll.eventTypes.scroll,this.checkPullUp))},a.prototype.unwatch=function(){this.watching=!1,this.scroll.off(this.scroll.eventTypes.scroll,this.checkPullUp)},a.prototype.checkPullUp=function(t){var o=this,i=this.options.threshold;1===this.scroll.movingDirectionY&&t.y<=this.scroll.maxScrollY+i&&(this.pulling=!0,this.scroll.once(this.scroll.eventTypes.scrollEnd,function(){o.pulling=!1}),this.unwatch(),this.scroll.trigger(h))},a.prototype.finishPullUp=function(){var t=this;this.scroll.scroller.scrollBehaviorY.setMovingDirection(0),this.pulling?this.scroll.once(this.scroll.eventTypes.scrollEnd,function(){t.watch()}):this.watch()},a.prototype.openPullUp=function(t){void 0===t&&(t={}),this.handleOptions(t),this.watch()},a.prototype.closePullUp=function(){this.unwatch()},a.prototype.autoPullUpLoad=function(){var t,o=this.options.threshold,i=this.scroll.scroller.scrollBehaviorY;!this.pulling&&this.watching&&(t=i.maxScrollPos+o+-1,this.scroll.scroller.scrollBehaviorY.setMovingDirection(-1),this.scroll.scrollTo(this.scroll.x,t,this.scroll.options.bounceTime))},a.pluginName="pullUpLoad",a});
