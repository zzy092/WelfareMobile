!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).NestedScroll={})}(this,function(t){"use strict";function h(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),o=0,e=0;e<n;e++)for(var s=arguments[e],i=0,a=s.length;i<a;i++,o++)r[o]=s[i];return r}var r="undefined"!=typeof window,n=r&&navigator.userAgent.toLowerCase();n&&/wechatdevtools/.test(n),n&&n.indexOf("android"),function(){if("string"!=typeof n)return;var t=/os (\d\d?_\d(_\d)?)/.exec(n);if(!t)return;var e=t[1].split("_").map(function(t){return parseInt(t,10)});13===e[0]&&e[1]}();if(r){try{var e={};Object.defineProperty(e,"passive",{get:function(){}}),window.addEventListener("test-passive",function(){},e)}catch(t){}}function l(t,o){if(t.findIndex)return t.findIndex(o);var s=-1;return t.some(function(t,e,n){var r=o(t,e,n);if(r)return s=e,r}),s}var o=r&&document.createElement("div").style,s=function(){if(!r)return!1;for(var t=0,e=[{key:"standard",value:"transform"},{key:"webkit",value:"webkitTransform"},{key:"Moz",value:"MozTransform"},{key:"O",value:"OTransform"},{key:"ms",value:"msTransform"}];t<e.length;t++){var n=e[t];if(void 0!==o[n.value])return n.key}return!1}();function i(t){return!1===s?t:"standard"===s?"transitionEnd"===t?"transitionend":t:s+t.charAt(0).toUpperCase()+t.substr(1)}s&&"standard"!==s&&s.toLowerCase();var a=i("transform"),c=i("transition"),u=(r&&i("perspective")in o,i("transitionTimingFunction"),i("transitionDuration"),i("transitionDelay"),i("transformOrigin"),i("transitionEnd"),i("transitionProperty"),f.create=function(t){return new f(t)},f.prototype.hasAncestors=function(e){return-1<l(this.ancestors,function(t){return t[0]===e})},f.prototype.hasDescendants=function(e){return-1<l(this.descendants,function(t){return t[0]===e})},f.prototype.addAncestor=function(t,e){var n=this.ancestors;n.push([t,e]),n.sort(function(t,e){return t[1]-e[1]})},f.prototype.addDescendant=function(t,e){var n=this.descendants;n.push([t,e]),n.sort(function(t,e){return t[1]-e[1]})},f.prototype.removeAncestor=function(e){var t=this.ancestors;if(t.length){var n=l(this.ancestors,function(t){return t[0]===e});if(-1<n)return t.splice(n,1)}},f.prototype.removeDescendant=function(e){var t=this.descendants;if(t.length){var n=l(this.descendants,function(t){return t[0]===e});if(-1<n)return t.splice(n,1)}},f.prototype.registerHooks=function(t,e,n){t.on(e,n),this.hooksManager.push([t,e,n])},f.prototype.setAnalyzed=function(t){void 0===t&&(t=!1),this.analyzed=t},f.prototype.purge=function(){var e=this;this.ancestors.forEach(function(t){t[0].removeDescendant(e)}),this.descendants.forEach(function(t){t[0].removeAncestor(e)}),this.hooksManager.forEach(function(t){var e=t[0],n=t[1],r=t[2];e.off(n,r)}),this.hooksManager=[]},f);function f(t){this.ancestors=[],this.descendants=[],this.hooksManager=[],this.analyzed=!1,this.selfScroll=t}function m(t){t.forEach(function(t){t.enable()})}function k(t,e){t.forEach(function(t){t.hasHorizontalScroll!==e.hasHorizontalScroll&&t.hasVerticalScroll!==e.hasVerticalScroll||t.disable()})}var d=[{key:"purgeNestedScroll",name:"purgeNestedScroll"}].map(function(t){return{key:t.key,sourceKey:"plugins.nestedScroll."+t.name}}),p="INTERNAL_NESTED_SCROLL",v=(y.getAllNestedScrolls=function(){var e=y.instancesMap;return Object.keys(e).map(function(t){return e[t]})},y.purgeAllNestedScrolls=function(){y.getAllNestedScrolls().forEach(function(t){return t.purgeNestedScroll()})},y.prototype.handleOptions=function(t){var e=!0===t.options.nestedScroll?{}:t.options.nestedScroll,n={groupId:p};this.options=function(t,e){for(var n in e)t[n]=e[n];return t}(n,e);var r=typeof this.options.groupId;return"string"!=r&&"number"!=r&&console.error("[BScroll warn]: groupId must be string or number for NestedScroll plugin"),this.options.groupId},y.prototype.init=function(t){t.proxy(d),this.addBScroll(t),this.buildBScrollGraph(),this.analyzeBScrollGraph(),this.ensureEventInvokeSequence(),this.handleHooks(t)},y.prototype.handleHooks=function(t){var e=this;this.registerHooks(t.hooks,t.hooks.eventTypes.destroy,function(){e.deleteScroll(t)})},y.prototype.deleteScroll=function(e){e.wrapper.isBScrollContainer=void 0;var t=this.store,n=this.hooksFn,r=l(t,function(t){return t.selfScroll===e});-1<r&&(t[r].purge(),t.splice(r,1));var o,s,i,a,c=l(n,function(t){return t[0]===e.hooks});-1<c&&(s=(o=n[c])[0],i=o[1],a=o[2],s.off(i,a),n.splice(c,1))},y.prototype.addBScroll=function(t){this.store.push(u.create(t))},y.prototype.buildBScrollGraph=function(){for(var t,e,n,r=this.store,o=this.store.length,s=0;s<o;s++){n=(t=r[s]).selfScroll.wrapper;for(var i=0;i<o;i++){var a,c=(e=r[i]).selfScroll.wrapper;t!==e&&n.contains(c)&&(a=function(t,e){for(var n=0,r=t.parentNode;r&&r!==e;)n++,r=r.parentNode;return n}(c,n),t.hasDescendants(e)||t.addDescendant(e,a),e.hasAncestors(t)||e.addAncestor(t,a))}}},y.prototype.analyzeBScrollGraph=function(){this.store.forEach(function(t){var S,p,g,e;t.analyzed||(S=t.ancestors,p=t.descendants,g=t.selfScroll,t.registerHooks(g,g.eventTypes.beforeScrollStart,function(){var t,e,n,r,o,s,i,a,c,l,u,f=S.map(function(t){return t[0].selfScroll}),d=p.map(function(t){return t[0].selfScroll});h(f,d).forEach(function(t){t.pending&&(t.stop(),t.resetPosition())}),n=(e=g).hasHorizontalScroll,r=e.hasVerticalScroll,o=e.x,s=e.y,i=e.minScrollX,a=e.maxScrollX,c=e.minScrollY,l=e.maxScrollY,u=!1,r?u=c<s||s<l:n&&(u=i<o||o<a),u&&((t=g).scroller.reflow(),t.resetPosition(0)),f.forEach(function(t){var e=t.scroller,n=e.actions,r=e.scrollBehaviorX,o=e.scrollBehaviorY;n.fingerMoved=!0,n.contentMoved=!1,n.directionLockAction.reset(),r.start(),o.start(),r.resetStartPos(),o.resetStartPos(),n.startTime=+new Date}),k(f,g)}),t.registerHooks(g,g.eventTypes.touchEnd,function(){var t=S.map(function(t){return t[0].selfScroll}),e=p.map(function(t){return t[0].selfScroll});m(h(t,e))}),e=g.scroller.actions.hooks,t.registerHooks(e,e.eventTypes.detectMovingDirection,function(){var t,e,n,r,o,s,i,a,c,l,u,f,d=S.map(function(t){return t[0].selfScroll}),p=d[0],h=d.slice(1),v=g.scroller.actions.contentMoved,y=0===d.length;if(v)k(d,g);else if(!y&&(e=(t=g).hasHorizontalScroll,n=t.hasVerticalScroll,r=t.x,o=t.y,s=t.minScrollX,i=t.maxScrollX,a=t.minScrollY,c=t.maxScrollY,l=t.movingDirectionX,u=t.movingDirectionY,f=!1,n?f=a<=o&&-1===u||o<=c&&1===u:e&&(f=s<=r&&-1===l||r<=i&&1===l),f))return k([g],g),p&&m([p]),k(h,g),!0}),t.setAnalyzed(!0))})},y.prototype.ensureEventInvokeSequence=function(){this.store.slice().sort(function(t,e){return t.descendants.length-e.descendants.length}).forEach(function(t){t.selfScroll.scroller.actionsHandler.rebindDOMEvents()})},y.prototype.registerHooks=function(t,e,n){t.on(e,n,this),this.hooksFn.push([t,e,n])},y.prototype.purgeNestedScroll=function(){var t=this.options.groupId;this.store.forEach(function(t){t.purge()}),this.store=[],this.hooksFn.forEach(function(t){var e=t[0],n=t[1],r=t[2];e.off(n,r)}),this.hooksFn=[],delete y.instancesMap[t]},y.pluginName="nestedScroll",y.instancesMap={},y);function y(t){var e=this.handleOptions(t),n=y.instancesMap[e];return n||((n=y.instancesMap[e]=this).store=[],n.hooksFn=[]),n.init(t),n}t.DEFAUL_GROUP_ID=p,t.default=v,Object.defineProperty(t,"__esModule",{value:!0})});
