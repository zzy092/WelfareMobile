!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):(t="undefined"!=typeof globalThis?globalThis:t||self).Indicators=i()}(this,function(){"use strict";var l=function(){return(l=Object.assign||function(t){for(var i,o=1,e=arguments.length;o<e;o++)for(var n in i=arguments[o])Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n]);return t}).apply(this,arguments)};function n(t,i){if(!t)throw new Error("[BScroll] "+i)}var e="undefined"!=typeof window,o=e&&navigator.userAgent.toLowerCase(),r=(o&&/wechatdevtools/.test(o),o&&o.indexOf("android"),function(){if("string"!=typeof o)return;var t=/os (\d\d?_\d(_\d)?)/.exec(o);if(!t)return;var i=t[1].split("_").map(function(t){return parseInt(t,10)});13===i[0]&&i[1]}(),!1);if(e){try{var t={};Object.defineProperty(t,"passive",{get:function(){r=!0}}),window.addEventListener("test-passive",function(){},t)}catch(t){}}function a(){return window.performance&&window.performance.now&&window.performance.timing?window.performance.now()+window.performance.timing.navigationStart:+new Date}function y(t,i,o){return t<i?i:o<t?o:t}var s=e&&document.createElement("div").style,i=function(){if(!e)return!1;for(var t=0,i=[{key:"standard",value:"transform"},{key:"webkit",value:"webkitTransform"},{key:"Moz",value:"MozTransform"},{key:"O",value:"OTransform"},{key:"ms",value:"msTransform"}];t<i.length;t++){var o=i[t];if(void 0!==s[o.value])return o.key}return!1}();function h(t){return!1===i?t:"standard"===i?"transitionEnd"===t?"transitionend":t:i+t.charAt(0).toUpperCase()+t.substr(1)}function c(t,i,o,e){var n=r?{passive:!1,capture:!!e}:!!e;t.addEventListener(i,o,n)}function p(t,i,o,e){t.removeEventListener(i,o,{capture:!!e})}i&&"standard"!==i&&i.toLowerCase();var d=h("transform"),u=(h("transition"),e&&h("perspective")in s,d),m=h("transitionTimingFunction"),f=h("transitionDuration");h("transitionDelay"),h("transformOrigin"),h("transitionEnd"),h("transitionProperty");var v=(g.prototype.destroy=function(){this.removeDOMEvents(),this.events=[]},g.prototype.addDOMEvents=function(){this.handleDOMEvents(c)},g.prototype.removeDOMEvents=function(){this.handleDOMEvents(p)},g.prototype.handleDOMEvents=function(i){var o=this,e=this.wrapper;this.events.forEach(function(t){i(e,t.name,o,!!t.capture)})},g.prototype.handleEvent=function(i){var o=i.type;this.events.some(function(t){return t.name===o&&(t.handler(i),!0)})},g);function g(t,i){this.wrapper=t,this.events=i,this.addDOMEvents()}function S(t){t.preventDefault(),t.stopPropagation()}var w=(x.prototype.handleDOM=function(){var t=this.options,i=t.relationElement,o=t.relationElementHandleElementIndex,e=void 0===o?0:o;this.wrapper=i,this.indicatorEl=this.wrapper.children[e]},x.prototype.handleHooks=function(){var i=this,t=this.scroll,o=t.hooks,e=t.scroller.translater.hooks,n=t.scroller.animater.hooks;this.registerHooks(o,o.eventTypes.refresh,this.refresh),this.registerHooks(e,e.eventTypes.translate,function(t){i.updatePosition(t)}),this.registerHooks(n,n.eventTypes.time,this.transitionTime),this.registerHooks(n,n.eventTypes.timeFunction,this.transitionTimingFunction)},x.prototype.transitionTime=function(t){void 0===t&&(t=0),this.indicatorEl.style[f]=t+"ms"},x.prototype.transitionTimingFunction=function(t){this.indicatorEl.style[m]=t},x.prototype.handleInteractive=function(){!1!==this.options.interactive&&this.registerEvents()},x.prototype.registerHooks=function(t,i,o){t.on(i,o,this),this.hooksFn.push([t,i,o])},x.prototype.registerEvents=function(){var t=this.scroll.options,i=t.disableMouse,o=t.disableTouch,e=[],n=[],r=[];i||(e.push({name:"mousedown",handler:this.start.bind(this)}),n.push({name:"mousemove",handler:this.move.bind(this)}),r.push({name:"mouseup",handler:this.end.bind(this)})),o||(e.push({name:"touchstart",handler:this.start.bind(this)}),n.push({name:"touchmove",handler:this.move.bind(this)}),r.push({name:"touchend",handler:this.end.bind(this)},{name:"touchcancel",handler:this.end.bind(this)})),this.startEventRegister=new v(this.indicatorEl,e),this.moveEventRegister=new v(window,n),this.endEventRegister=new v(window,r)},x.prototype.refresh=function(){var t,i,o,e=this.scroll,n=e.x,r=e.y,s=e.hasHorizontalScroll,a=e.hasVerticalScroll,h=e.maxScrollX,l=e.maxScrollY,c=(t=this.options.ratio,i={ratioX:0,ratioY:0},t&&("number"==typeof t?i.ratioX=i.ratioY=t:"object"==typeof t&&t&&(i.ratioX=t.x||0,i.ratioY=t.y||0)),i),p=c.ratioX,d=c.ratioY,u={width:(o=this.wrapper).clientWidth,height:o.clientHeight},m=u.width,f=u.height,v=function(t){if(t instanceof window.SVGElement){var i=t.getBoundingClientRect();return{top:i.top,left:i.left,width:i.width,height:i.height}}return{top:t.offsetTop,left:t.offsetLeft,width:t.offsetWidth,height:t.offsetHeight}}(this.indicatorEl),y=v.width,g=v.height;s&&(this.maxScrollX=m-y,this.translateXSign=0<this.maxScrollX?-1:1,this.minScrollX=0,this.ratioX=p||Math.abs(this.maxScrollX/h)),a&&(this.maxScrollY=f-g,this.translateYSign=0<this.maxScrollY?-1:1,this.minScrollY=0,this.ratioY=d||Math.abs(this.maxScrollY/l)),this.updatePosition({x:n,y:r})},x.prototype.start=function(t){var i;this.BScrollIsDisabled()||(i=t.touches?t.touches[0]:t,S(t),this.initiated=!0,this.moved=!1,this.lastPointX=i.pageX,this.lastPointY=i.pageY,this.startTime=a(),this.scroll.scroller.hooks.trigger(this.scroll.scroller.hooks.eventTypes.beforeScrollStart))},x.prototype.BScrollIsDisabled=function(){return!this.scroll.enabled},x.prototype.move=function(t){var i,o,e,n,r,s;this.initiated&&(o=(i=t.touches?t.touches[0]:t).pageX,e=i.pageY,S(t),n=o-this.lastPointX,r=e-this.lastPointY,this.lastPointX=o,this.lastPointY=e,this.moved||this.indicatorNotMoved(n,r)||(this.moved=!0,this.scroll.scroller.hooks.trigger(this.scroll.scroller.hooks.eventTypes.scrollStart)),this.moved&&(s=this.getBScrollPosByRatio(this.currentPos,n,r),this.syncBScroll(s)))},x.prototype.end=function(t){var i,o,e;this.initiated&&(this.initiated=!1,S(t),this.moved&&(o=(i=this.scroll).x,e=i.y,this.scroll.scroller.hooks.trigger(this.scroll.scroller.hooks.eventTypes.scrollEnd,{x:o,y:e})))},x.prototype.getBScrollPosByRatio=function(t,i,o){var e,n,r=t.x,s=t.y,a=this.scroll,h=a.hasHorizontalScroll,l=a.hasVerticalScroll,c=a.minScrollX,p=a.maxScrollX,d=a.minScrollY,u=a.maxScrollY,m=this.scroll,f=m.x,v=m.y;return h&&(e=y(r+i,Math.min(this.minScrollX,this.maxScrollX),Math.max(this.minScrollX,this.maxScrollX)),f=y(Math.round(e/this.ratioX*this.translateXSign),p,c)),l&&(n=y(s+o,Math.min(this.minScrollY,this.maxScrollY),Math.max(this.minScrollY,this.maxScrollY)),v=y(Math.round(n/this.ratioY*this.translateYSign),u,d)),{x:f,y:v}},x.prototype.indicatorNotMoved=function(t,i){var o=this.currentPos,e=o.x,n=o.y,r=e===this.minScrollX&&t<=0||e===this.maxScrollX&&0<=t,s=n===this.minScrollY&&i<=0||n===this.maxScrollY&&0<=i;return r&&s},x.prototype.syncBScroll=function(t){var i=a(),o=this.scroll,e=o.options,n=o.scroller,r=e.probeType,s=e.momentumLimitTime;n.translater.translate(t),i-this.startTime>s&&(this.startTime=i,1===r&&n.hooks.trigger(n.hooks.eventTypes.scroll,t)),1<r&&n.hooks.trigger(n.hooks.eventTypes.scroll,t)},x.prototype.updatePosition=function(t){var i=this.getIndicatorPosByRatio(t);this.applyTransformProperty(i),this.currentPos=l({},i)},x.prototype.applyTransformProperty=function(t){var i=this.scroll.options.translateZ,o=["translateX("+t.x+"px)","translateY("+t.y+"px)",""+i];this.indicatorEl.style[u]=o.join(" ")},x.prototype.getIndicatorPosByRatio=function(t){var i,o,e=t.x,n=t.y,r=this.scroll,s=r.hasHorizontalScroll,a=r.hasVerticalScroll,h=l({},this.currentPos);return s&&(i=Math.round(this.ratioX*e*this.translateXSign),h.x=y(i,Math.min(this.minScrollX,this.maxScrollX),Math.max(this.minScrollX,this.maxScrollX))),a&&(o=Math.round(this.ratioY*n*this.translateYSign),h.y=y(o,Math.min(this.minScrollY,this.maxScrollY),Math.max(this.minScrollY,this.maxScrollY))),h},x.prototype.destroy=function(){!1!==this.options.interactive&&(this.startEventRegister.destroy(),this.moveEventRegister.destroy(),this.endEventRegister.destroy()),this.hooksFn.forEach(function(t){var i=t[0],o=t[1],e=t[2];i.off(o,e)}),this.hooksFn.length=0},x);function x(t,i){this.scroll=t,this.options=i,this.currentPos={x:0,y:0},this.hooksFn=[],this.handleDOM(),this.handleHooks(),this.handleInteractive()}function E(t){this.scroll=t,this.options=[],this.indicators=[],this.handleOptions(),this.handleHooks()}return E.prototype.handleOptions=function(){var t=this.scroll.options.indicators;n(Array.isArray(t),"'indicators' must be an array.");for(var i=0,o=t;i<o.length;i++){var e=o[i];n(!!e.relationElement,"'relationElement' must be a HTMLElement."),this.createIndicators(e)}},E.prototype.createIndicators=function(t){this.indicators.push(new w(this.scroll,t))},E.prototype.handleHooks=function(){var o=this,t=this.scroll.hooks;t.on(t.eventTypes.destroy,function(){for(var t=0,i=o.indicators;t<i.length;t++){i[t].destroy()}o.indicators=[]})},E.pluginName="indicators",E});
